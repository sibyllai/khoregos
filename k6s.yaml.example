# k6s.yaml â€” Khoregos project governance configuration.
# This file configures sessions, boundaries, gates, and observability for your project.
# Copy to k6s.yaml and customize for your needs.

version: "1"

project:
  name: "my-project"
  description: "Project governed by Khoregos"

# Session defaults.
session:
  context_retention_days: 90          # How long to keep saved context entries.
  audit_retention_days: 365           # How long to keep audit events before auto-pruning.
  # When a Claude Code session ends (or is killed), the k6s session is
  # automatically completed and cleaned up. Set to false to keep the k6s
  # session alive across multiple Claude invocations; you will then need
  # to run `k6s team stop` explicitly to end it.
  end_on_claude_exit: true

# Agent boundary definitions.
# Boundaries restrict which files agents can modify.
boundaries:
  # Frontend agents can only modify frontend code.
  - pattern: "frontend-*"
    allowed_paths:
      - "src/frontend/**"
      - "src/shared/**"
      - "tests/frontend/**"
      - "public/**"
    forbidden_paths:
      - ".env*"
      - "src/backend/auth/**"
    enforcement: advisory              # "advisory" logs violations; "strict" reverts them.

  # Backend agents stay in backend code.
  - pattern: "backend-*"
    allowed_paths:
      - "src/backend/**"
      - "src/shared/**"
      - "tests/backend/**"
    forbidden_paths:
      - ".env*"
      - "infrastructure/**"
    enforcement: advisory

  # Catch-all: every agent is blocked from secrets and keys.
  - pattern: "*"
    forbidden_paths:
      - ".env*"
      - "**/*.pem"
      - "**/*.key"
      - "**/credentials*"
      - "**/secrets/**"
    enforcement: advisory

# Gate rules.
# Gates flag sensitive operations for human review via audit annotations.
gates:
  - id: dependency-approval
    name: "New Dependency Approval"
    trigger:
      file_patterns:
        - "package.json"
        - "package-lock.json"
        - "yarn.lock"
        - "requirements.txt"
        - "Pipfile"
        - "pyproject.toml"
        - "go.mod"
        - "Cargo.toml"
        - "**/pom.xml"
    approval_mode: manual
    timeout_seconds: 1800
    notify: ["terminal"]

  - id: security-files
    name: "Security File Changes"
    trigger:
      file_patterns:
        - ".env*"
        - "**/auth/**"
        - "**/security/**"
        - "**/*.pem"
        - "**/*.key"
    approval_mode: manual
    notify: ["terminal"]

# Observability configuration.
observability:
  prometheus:
    enabled: false
    port: 9090
  opentelemetry:
    enabled: false
    endpoint: "http://localhost:4317"
  webhooks: []
    # Example webhook configuration:
    # - url: "https://hooks.slack.com/services/..."
    #   events: ["gate.triggered", "session.completed"]
    #   secret: "$K6S_WEBHOOK_SECRET"

# Plugin configuration (roadmap).
plugins: []
  # Example plugin configuration:
  # - name: "stegano"
  #   module: "k6s-plugin-stegano"
  #   config:
  #     api_url: "https://api.stegano.ai"
